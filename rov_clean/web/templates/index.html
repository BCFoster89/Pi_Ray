<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ROV Cockpit</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <!-- Video Background -->
  <div id="video-container">
    <img id="cam" src="/video_feed">
    <canvas id="overlay"></canvas>
  </div>

  <!-- Floating Controls -->
  <div id="controls">
    <div class="card hud-card">
      <h3>Thrusters</h3>
      <!-- Visual ROV thruster diagram -->
      <div class="thruster-display">
        <div class="rov-diagram">
          <div class="thruster-row">
            <div class="thruster" id="thruster-8">
              <span class="thruster-label">FL</span>
              <div class="duty-bar"><div class="duty-fill" id="fill-8"></div></div>
              <span class="duty-value" id="duty-8">0%</span>
            </div>
            <div class="thruster" id="thruster-12">
              <span class="thruster-label">FR</span>
              <div class="duty-bar"><div class="duty-fill" id="fill-12"></div></div>
              <span class="duty-value" id="duty-12">0%</span>
            </div>
          </div>
          <div class="rov-body">ROV</div>
          <div class="thruster-row">
            <div class="thruster" id="thruster-16">
              <span class="thruster-label">RL</span>
              <div class="duty-bar"><div class="duty-fill" id="fill-16"></div></div>
              <span class="duty-value" id="duty-16">0%</span>
            </div>
            <div class="thruster" id="thruster-13">
              <span class="thruster-label">RR</span>
              <div class="duty-bar"><div class="duty-fill" id="fill-13"></div></div>
              <span class="duty-value" id="duty-13">0%</span>
            </div>
          </div>
        </div>
        <!-- Vertical thrust controls (stacked) -->
        <div class="vertical-thrusters stacked">
          <div class="thruster vertical" id="thruster-descend">
            <span class="thruster-label">Descend</span>
            <div class="duty-bar vertical"><div class="duty-fill" id="fill-descend"></div></div>
            <span class="duty-value" id="duty-descend">0%</span>
          </div>
          <div class="thruster vertical ascend-indicator" id="thruster-ascend">
            <span class="thruster-label">Ascend</span>
            <div class="duty-bar vertical"><div class="duty-fill" id="fill-ascend"></div></div>
            <span class="duty-value" id="duty-ascend">0%</span>
          </div>
        </div>
      </div>
      <!-- Emergency stop -->
      <button class="emergency-stop" onclick="emergencyStop()">ALL STOP</button>
      <!-- Control mode indicator -->
      <div class="control-mode" id="control-mode">Mode: Manual</div>
    </div>

    <div class="card hud-card">
      <h3>Recording</h3>
      <div class="button-grid">
        <button id="recordBtn" class="record-btn" onclick="toggleRecording()">Record</button>
        <button id="captureBtn" onclick="captureImage()">Capture</button>
      </div>
      <div id="recordingStatus" class="recording-status"></div>
    </div>

    <div class="card hud-card">
      <h3>Depth Hold</h3>
      <div class="button-grid">
        <button id="depthHoldBtn" onclick="toggleDepthHold()">Depth Hold</button>
      </div>
      <div id="depthHoldStatus" class="depth-hold-status"></div>
      <div class="pid-tuning" id="pidTuning">
        <div class="pid-row">
          <label>Kp:</label>
          <input type="number" id="pidKp" value="0.5" step="0.1" min="0" max="5">
        </div>
        <div class="pid-row">
          <label>Ki:</label>
          <input type="number" id="pidKi" value="0.1" step="0.05" min="0" max="2">
        </div>
        <div class="pid-row">
          <label>Kd:</label>
          <input type="number" id="pidKd" value="0.2" step="0.05" min="0" max="2">
        </div>
        <button onclick="updatePIDGains()">Update PID</button>
      </div>
    </div>

    <div class="card hud-card">
      <h3>Calibration</h3>
      <div class="button-grid">
        <button onclick="calibrateDepth()">Zero Depth</button>
        <button onclick="calibrateHorizon()">Zero Horizon</button>
        <button onclick="zeroIMU()">Zero IMU</button>
        <button onclick="toggleLED()">Toggle LED</button>
      </div>
    </div>

    <div class="card hud-card" id="statusCard">
      <h3>Status</h3>
      <button id="statusBtn">Pi Status: UNKNOWN</button>
    </div>

    <div class="card hud-card" id="telemetryCard">
      <h3>Telemetry</h3>
      <pre id="telemetry"></pre>
    </div>

    <div class="card hud-card" id="logsCard">
      <h3>Logs</h3>
      <pre id="logs"></pre>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
